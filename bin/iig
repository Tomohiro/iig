#!/usr/bin/env ruby

require 'rubygems'
require 'slop'
require 'iig'

opts = Slop.parse :help => true do
  banner "Usage: #{File.basename(__FILE__)} [options]"
  on :p, :port,    'Port number to listen',             argument: :optional,  as: :integer, default: 16704
  on :s, :server,  'Host name or IP address to listen', argument: :optional,  as: :string,  default: :localhost
  on :l, :log,     'Log file',                          argument: :optional,  as: :string,  default: nil
  on :v, :version, 'Print the version' do
    puts InterestIrcGateway::VERSION
    exit
  end
end

exit if opts.present?(:help)

logger = Logger.new(opts[:log] || STDOUT, 'daily')
logger.level = Logger::DEBUG

Net::IRC::Server.new(opts[:server], opts[:port], InterestIrcGateway::Session, opts.to_hash.merge({ logger: logger })).start
